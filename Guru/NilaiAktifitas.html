<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPLH</title>
    <link rel="stylesheet" href="css/datasiswa.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../fontawesome/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
    <!-- ADDITIONAL JQUERY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" charset="UTF-8"></script>
</head>

<style>
    td.upper_line { border-top:solid 1px black; }
    table.fraction { text-align: center; vertical-align: middle;
        margin-top:0.5em; margin-bottom:0.5em; line-height: 2em; }
    
    img{
        border: 1px solid #000000;
        margin: 10px;
    }

    .accordion {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
  transition: 0.4s;
}

.active, .accordion:hover {
  background-color: #ccc;
}

.panel {
  padding: 0 18px;
  background-color: white;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.2s ease-out;
}



</style>

<body>
    <!-- HEADER AREA START-->
    <input type="checkbox" id="check">
    <header>
      <label for="check">
          <i class="fas fa-bars" id="sidebar_btn"></i>
      </label>
      <div class="left_area">
          <a href="../index.html"><h3>PPLH</h3></a>
      </div>
      <div class="right_area">
        <a id="logout" href="../index.html" class="logout_btn"><i class="fa fa-sign-out"></i></a>
        <h5 id="nama" style><i class="fa-solid fa-user"></i></h5>
      </div>
      <div class="progress-container">
          <div class="progress-bar" id="myBar"></div>
      </div> 
  </header>
    <!-- HEADER AREA END tulis tahap-->

    <!-- SIDEBAR START -->
    <nav class="sidebar">
        <div class="profile_info">
            <h3><b>Menu</b></h3>
            <hr style="width: 90%; background-color: white !important; margin: 5px 0 5px 0; height:3px !important;" >
        </div>
        <ul>
            <li><a href="datasiswa.html" class="menu-btn"><i class="fa-solid fa-user"></i>&ensp;Daftar Siswa</a></li>
            <li id="active"><a href="#" class="menu-btn"><i class="fa-regular fa-address-book"></i>&ensp;Hasil Kegiatan Kelompok</a></li>
            <li><a href="NilaiLatihan.html" class="menu-btn"><i class="fa-solid fa-clipboard-list"></i>&ensp;Nilai Latihan</a></li>
            <li><a href="KuisdanEvaluasi.html" class="menu-btn"><i class="fa-solid fa-square-poll-vertical"></i>&ensp;Nilai Kuis dan Evaluasi</a></li>
            <li><a href="ManajemenKelompok.html" class="menu-btn"><i class="fa-solid fa-people-group"></i></i>&ensp;Manajemen Kelompok</a></li>
            <li><a href="ArsipKelompok.html" class="menu-btn"><i class="fa-solid fa-users"></i>&ensp;Arsip Kelompok</a></li>
      </ul>
    </nav>
    <!-- SIDEBAR END -->
    <div class="modal fade" id="modalHasilKegiatanKelompok" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold text-dark" id="exampleModalLabel">HASIL KEGIATAN KELOMPOK</h5>
            <button type="button" class="btn-close" id="close-modal-kelompok" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="container mt-3">
              <!-- <div class="table-responsive">
                <table class="table table-striped">
                  <thead class="text-center">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable">
                    <tr class="text-center">
                      <th scope="row">1</th>
                      <td>Kelompok A</td>
                      <td>Anggota 1, Anggota 2, Anggota 3</td>
                      <td>Lembar Kegiatan 1</td>
                    </tr>
                    Tambahkan baris lainnya di sini
                  </tbody>
                </table>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    

    <!-- CONTENT AREA START-->
    <div class="content">
    <!-------------------------------------------------------- Nilai Kuis dan Evaluasi ------------------------------------------------------------------>
      <div class="card-header"><center>Hasil Kegiatan Kelompok</center></div>
        <!-----------------------------------------------Modal Tambah Data Siswa ------------------------------------------------------->
        <!-- <div class="modal fade" id="tambahModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered " >
              <div class="modal-content" style="background-color: white;">
                <div class="modal-header">
                  <h5 class="modal-title fw-bold text-dark " id="exampleModalLabel">TAMBAH DATA</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" >
                  <div class="popup add">
                    <form action="" style="background-color: white;">
                      <div class="mb-3">
                        <label>NISN :</label>
                        <input type="text" class="form-control" id="tambahNisnbox">
                      </div>
                      <div class="mb-3">
                        <label>Nama :</label>
                        <input type="text" class="form-control" id="tambahNamabox">
                      </div>
                      <div class="mb-3">
                        <label>Kelas :</label>
                        <input type="text" class="form-control" id="tambahKelasbox">
                      </div>
                      <div class="mb-3">
                        <label>Kelompok :</label>
                        <input type="text" class="form-control" id="tambahKelompokbox">
                      </div>
                      <div class="mb-3">
                        <label>Password :</label>
                        <input type="text" class="form-control" id="tambahPasswordbox">
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Kembali</button>
                        <button type="submit" class="btn btn-success" id="submit">Tambah</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
         -->
        <br>

        <!-------------------------------------------------------------Tabel Siswa ----------------------------------------------------------->
        
        <!-- <button class="btn align-text-right" data-bs-toggle="modal" data-bs-target="#tambahModal" id="tambah" style="background-color: #AAD8D3; color: #555; margin-right: 9px;">Tambah Kelompok</button> -->
        <!-- <button class="btn btn-primary" id="tampilkanModal">Lihat Hasil Kegiatan Kelompok</button> -->
        <div class= "content-card" id="menu-show1">
          <div class="table-responsive-sm container mt-3">
            <!-- <div class="table-responsive-sm container mt-3">
              <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                      <tr>
                          <th>No.</th>
                          <th>Kelompok</th>
                          <th>Token</th>
                          <th>Pengawas</th>
                          <th>Aksi</th>
                          
                        </tr>
                  </thead>
                  <tbody id="tbody1"></tbody>
                  
              </table>
            </div> -->

            <div class="tabk">
              <button class="tablinks" id="defaultOpen" onclick="openMenu(event, 'Materi1')">Materi 1</button>
              <button class="tablinks" id="defaultOpen btn2" onclick="openMenu(event, 'Materi2')">Materi 2</button>
              <button class="tablinks" id="defaultOpen btn3" onclick="openMenu(event, 'Materi3')">Materi 3</button>
              <button class="tablinks" id="defaultOpen btn4" onclick="openMenu(event, 'Materi4')">Materi 4</button>
              <button class="tablinks" id="defaultOpen btn5" onclick="openMenu(event, 'Materi5')">Materi 5</button>
              <button class="tablinks" id="defaultOpen btn6" onclick="openMenu(event, 'Materi6')">Materi 6</button>
              <button class="tablinks" id="defaultOpen btnEva" onclick="openMenu(event, 'Evaluasi')">Evaluasi</button>
            </div>
            
            <div id="Materi1" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable1">
                  </tbody>
                </table>

              </div>
            </div>
            
            <div id="Materi2" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable2">
                  </tbody>
                </table>

              </div>
            </div>
            
            <div id="Materi3" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable3">
                  </tbody>
                </table>

              </div>
            </div>
            
            <div id="Materi4" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable4">
                  </tbody>
                </table>

              </div>
            </div>
            
            <div id="Materi5" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable5">
                  </tbody>
                </table>

              </div>
            </div>
            
            <div id="Materi6" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable6">
                  </tbody>
                </table>

              </div>
            </div>
            
            <div id="Evaluasi" class="tabcontent">
              <div class="table-responsive">
                <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                  <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <tr>
                      <th scope="col">No</th>
                      <th scope="col">Kelompok</th>
                      <th scope="col">Anggota</th>
                      <th scope="col">Lembar Kegiatan</th>
                      <th scope="col">Nilai</th>
                      <th scope="col">Rata-rata</th>
                      <th scope="col">Penghargaan</th>
                    </tr>
                  </thead>
                  <tbody id="bodyTable7">
                  </tbody>
                </table>

              </div>
            </div>
        </div>

            
          </div>
        </div>

         <!-- Modal Tambah Kelas -->
         <div class="modal fade" id="tambahModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered " >
              <div class="modal-content" style="background-color: white;">
                <div class="modal-header">
                  <h5 class="modal-title fw-bold text-dark " id="exampleModalLabel">TAMBAH KELOMPOK</h5>
                  <button type="button" class="btn-close delete-progress"  aria-label="Close"></button>
                </div>
                <div class="modal-body" >
                  <div class="popup add">
                    <form action="" style="background-color: white;">
                      <div class="mb-3">
                        <label>Kelompok :</label>
                        <input type="text" class="form-control" id="namaKelas" required>
                      </div>
                      <div class="mb-3">
                        <label>Token :</label>
                        <input type="text" class="form-control" id="tokenKelas" required
                      </div>
                      <div class="mb-3">
                        <label>Guru Pengawas :</label>
                        <select class="form-control" id="pengawasKelompok" required>
                        </select>
                      </div>
                    
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary delete-progress">Kembali</button>
                        <button type="submit" class="btn btn-success" id="tambahBtn">Tambah</button>
                        <button type="button" class="btn btn-warning" id="simpanBtn">Ubah</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
        </div>

          
        
        <!--------------------------------------------------------------Footer -------------------------------------------------------------->
        <!-- <div class="footer-nav">
            <a href="#" class="footer-number">Sebelumnya</a>
            <a href="#" class="footer-number">1</a>
            <a href="#" class="footer-number">2</a>
            <a href="#" class="footer-number">3</a>
            <a href="#" class="footer-number">Selanjutnya</a>
        </div> -->
    </div>

    <style>
      .floating-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000; /* untuk memastikan tombol muncul di atas konten lain */
      }
  
      .chat-room {
          z-index: 1000;
        width: 400px;
        height: 500px;
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #fff;
        border: 1px solid #424242;
        border-radius: 5px;
      }
  
      .chat-header {
        background-color: #AAD8D3;
        color: #fff;
        padding: 10px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
      }
  
      .chat-body {
        overflow-y: auto;
        padding: 10px;
        height: calc(100% - 140px);
      }
  
      .chat-footer {
          margin-bottom: 0;
        padding: 10px;
        border-top: 1px solid #ccc;
        display: flex; /* Mengatur elemen dalam satu baris */
        align-items: center; /* Menyelaraskan elemen secara vertikal */
      }
  
      .bubble {
        max-width: 70%;
        margin-bottom: 10px;
        clear: both;
        overflow: hidden;
        padding: 10px;
        border-radius: 10px;
        word-wrap: break-word;
      }
  
      .bubble.me {
        float: right;
        background-color: #007bff;
        color: #fff;
      }
  
      .bubble.other {
        float: left;
        background-color: #28a745;
        color: #fff;
      }
  
      .chat-time {
        font-size: 0.8em;
        float: right;
      }
      .close-btn {
          margin-top: -30px;
          float: right;
      }

      /* Style untuk elemen input teks */
      #messageInput {
          width: calc(100% - 60px); 
          border: 2px solid #AAD8D3; 
          border-radius: 5px; 
          margin-right: 10px; 
          box-sizing: border-box; 
      }

      /* Style untuk tombol kirim */
      #sendButton {
          width: 40px; 
          height: 40px; 
          background-color: #AAD8D3; 
          border: none; 
          border-radius: 100%; 
          color: #fff;
          font-size: 1.2em; 
          cursor: pointer;
      }
      #sendButton:hover{
          background-color: #2F323A; 
      }
    </style>
       <!-- Floating Button -->
<!-- Floating Button -->
<!-- <button id="floatingButton" class="btn btn-primary floating-button">Chat</button> -->



<div id="container-chat"></div>

<!-- Popup untuk room chat -->
<div id="chatPopup" class="chat-room" style="display: none;">
<div class="chat-header">
<h4 class="mt-2 ms-2" id="namaKelompokRoomChat">Nama Kelompok</h4>
  <button type="button" class="btn-close close-btn" id="closeChat" aria-label="Close"></button>
  <div class="ms-2" id="anggota-kelompok-chat">
      
  </div>
</div>
<div class="chat-body" id="chatMessages"></div>
<div class="chat-footer">
<input type="text" class="form-control" id="messageInput" placeholder="Ketik pesan...">
<button type="button" class="btn btn-block" id="sendButton"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
  <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"/>
</svg></button>
</div>
</div>
    
    <!--CONTENT AREA END -->
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
    <script type="module">
      //---------project setting firebase-----------
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
      
      const firebaseConfig = {
          apiKey: "AIzaSyBAEK9blcK9ZjeIT8kPPWk8_xv7jgwjYQo",
          authDomain: "pplh-70ccb.firebaseapp.com",
          databaseURL: "https://pplh-70ccb-default-rtdb.firebaseio.com",
          projectId: "pplh-70ccb",
          storageBucket: "pplh-70ccb.appspot.com",
          messagingSenderId: "823611849079",
          appId: "1:823611849079:web:a0f8c81197a46a2e1dc972"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      import { getDatabase, ref, child, onValue, get, set, query, remove, orderByChild, onChildAdded, equalTo, update, orderByKey, limitToLast}
      from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
      
      const db = getDatabase();
      
      let anggota_kelompok = {}

// ======================================= DAPATKAN GROUP YAN GBERISI SISWA =================================


    let sendButton = document.getElementById('sendButton')
    sendButton.addEventListener('click',  () => {
      sendMessage(chat_aktif); 
    })



    const queA = query(ref(db, "dataSiswa/"));
    onValue(queA, (snapshot) => {
      const users = snapshot.val();
      // Mengelompokkan pengguna berdasarkan kelompok
      Object.values(users).forEach(user => {
        if(!anggota_kelompok[user.kelompok]){ 
            anggota_kelompok[user.kelompok] = {};
        };
        if(!anggota_kelompok[user.kelompok][user.nisn]){ 
            anggota_kelompok[user.kelompok][user.nisn] = {};
        };
        anggota_kelompok[user.kelompok][user.nisn] = {
          nama : user.nama,
          konfirmasi : user.konfirmasi,
          kerja_kelompok : user.kerja_kelompok,
          kuis1 : user.kuis1,
          kuis1 : user.kuis2,
          kuis1 : user.kuis3,
          kuis1 : user.kuis4,
          kuis1 : user.kuis5,
          kuis1 : user.kuis6,
          evaluasi : user.Evaluasi,

        };
      });
    });

    console.log(anggota_kelompok)


// ================================== LOAD NIALI KELOMPOK 
function loadNilaiKelompok(materi=1){
  let tmpKelompok = document.getElementById('bodyTable'+materi)
  const queKelompok = query(ref(db, "dataSiswa/"));
  let nilaiKelompok = {};
  onValue(queKelompok, (snapshot) => {
    tmpKelompok.innerHTML = "";
      var no = 1;
      const users = snapshot.val();
      const groupedUsers = {};
  
      // Mengelompokkan pengguna berdasarkan kelompok
      Object.values(users).forEach(user => {
          const kelompok = user.kelompok;
          if (!groupedUsers[kelompok]) {
              groupedUsers[kelompok] = [];
          }
          groupedUsers[kelompok].push(user);
      });
  
      // Mengurutkan kelompok secara alfabetis
      const sortedGroups = Object.keys(groupedUsers).sort();
  
      // Membuat baris tabel untuk setiap kelompok
      sortedGroups.forEach(kelompok => {
          const usersInGroup = groupedUsers[kelompok];
          // Pastikan nilaiKelompok[kelompok] didefinisikan sebagai objek sebelum menetapkan propertinya
          if (!nilaiKelompok[kelompok]) {
            nilaiKelompok[kelompok] = {};
          }
          nilaiKelompok[kelompok]['nilai'] = 0;
          nilaiKelompok[kelompok]['total_anggota'] = 0;
          let list = "";
          let N = "";
          
          let listFile = "";
          usersInGroup.forEach(user => {
              list += `<input class="form-check-input ms-2 mb-2" type="radio" id="anggotakelompok" name="namaanggota" value="${user.nama}" disabled>
                      <label class="ms-2" for="namaanggota">${user.nama}</label><br>`;
  
                let contextMateri = null;
                switch (materi){
                  case 1 :
                    contextMateri = user.kerja_kelompok?.materi1 || null;
                    break;
                  case 2 :
                    contextMateri = user.kerja_kelompok?.materi2 || null;
                    break;
                  case 3 :
                    contextMateri = user.kerja_kelompok?.materi3 || null;
                    break;
                  case 4 :
                    contextMateri = user.kerja_kelompok?.materi4 || null;
                    break;
                  case 5 :
                    contextMateri = user.kerja_kelompok?.materi5 || null;
                    break;
                  case 6 :
                    contextMateri = user.kerja_kelompok?.materi6 || null;
                    break;
                  case 7 :
                    contextMateri = user.kerja_kelompok?.evaluasi || null;
                    break;
                  default:
                  contextMateri = user.kerja_kelompok?.materi1 || null;
                    break;
                }
        
                try{
                
                  let namaFile = contextMateri?.files.nama_file || '';
                  let urlFile = contextMateri?.files.url || '';
                  let Nilai = contextMateri?.nilai || 0;
  
                  
                  N += `<span>${Nilai}</span><br>`;
                  nilaiKelompok[kelompok]['nilai'] += Nilai;
                  nilaiKelompok[kelompok]['total_anggota']++;
                  if(urlFile === '' && namaFile === ''){
                    listFile += `<t class="mb-5" >File Not Found !</t><br>`
                  } else {
                    listFile += `<a href="${urlFile}">${namaFile}</a><br>`;
                  }
                  
  
              } catch(e){
                  listFile += `<t class="mb-5" >File Not Found !</t><br>`
              }
              
          });
          let rerataNilai = nilaiKelompok[kelompok]['nilai'] / nilaiKelompok[kelompok]['total_anggota'];
          nilaiKelompok[kelompok]['rerata'] = rerataNilai;
          let tr = `
              <tr class="m-1 ms-3">
                  <td class="text-center">${no}</td>
                  <td class="text-center"><label for="namakelompok">${kelompok}</label></td>
                  <td>${list}</td>
                  <td class="text-center">
                      ${listFile}
                  </td>
                  <td class="text-center">${N}</td>
                  <td class="text-center">${rerataNilai}</td>
                  <td class="text-center" id="peringkat-${kelompok}-${materi}"></td>
              </tr>
          `;
          tmpKelompok.innerHTML += tr;
          no++;
      });
  
      // Mengurutkan kelompok berdasarkan rerata nilai tertinggi
      const sortedKelompok = Object.keys(nilaiKelompok).sort((a, b) => {
          return nilaiKelompok[b]['rerata'] - nilaiKelompok[a]['rerata'];
      });

      // Menetapkan peringkat berdasarkan urutan peringkat rerata nilai
      sortedKelompok.forEach((kelompok, index) => {
          nilaiKelompok[kelompok]['peringkat'] = index + 1;
      });

      sortedGroups.forEach(kelompok => {
        let penghargaanColumn = document.getElementById('peringkat-'+kelompok+'-'+materi);
        penghargaanColumn.innerHTML = nilaiKelompok[kelompok]['peringkat'];
      });

    });  

}

loadNilaiKelompok();

$('.btn2').click(loadNilaiKelompok(2));
$('.btn3').click(loadNilaiKelompok(3));
$('.btn4').click(loadNilaiKelompok(4));
$('.btn5').click(loadNilaiKelompok(5));
$('.btn6').click(loadNilaiKelompok(6));
$('.btnEva').click(loadNilaiKelompok(7));

    // =======================================================================================
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    let nama2 = document.getElementById('nama');
    let nm = sessionStorage.getItem('nama');
    let username = sessionStorage.getItem('username');

    nama2.innerHTML = `<i class="fa-solid fa-user"></i> ${nm}`;

    let logout = document.getElementById("logout");
    logout.addEventListener("click", ()=>{
        // Membersihkan session storage
        sessionStorage.clear();
    });
    isConfirmUser = true;

    function openMenu(evt, menu) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(menu).style.display = "block";
    evt.currentTarget.className += " active";
  }
  
  // Get the element with id="defaultOpen" and click on it
  document.getElementById("defaultOpen").click();
  </script>
</body> 
</html>

    <!-- JAVASCRIPT AREA END -->