<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPLH</title>
    <link rel="stylesheet" href="css/datasiswa.css">
    <link rel="stylesheet" href="../fontawesome/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
    <!-- ADDITIONAL JQUERY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" charset="UTF-8"></script>
</head>

<style>
    td.upper_line { border-top:solid 1px black; }
    table.fraction { text-align: center; vertical-align: middle;
        margin-top:0.5em; margin-bottom:0.5em; line-height: 2em; }
    
    img{
        border: 1px solid #000000;
        margin: 10px;
    }

    .accordion {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
  transition: 0.4s;
}

.active, .accordion:hover {
  background-color: #ccc;
}

.panel {
  padding: 0 18px;
  background-color: white;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.2s ease-out;
}

</style>

<body>
    <!-- HEADER AREA START-->
    <input type="checkbox" id="check">
    <header>
      <label for="check">
          <i class="fas fa-bars" id="sidebar_btn"></i>
      </label>
      <div class="left_area">
          <a href="../index.html"><h3>PPLH</h3></a>
      </div>
      <div class="right_area">
        <a id="logout" href="../index.html" class="logout_btn"><i class="fa fa-sign-out"></i></a>
        <h5 id="nama" style><i class="fa-solid fa-user"></i></h5>
      </div>
      <div class="progress-container">
          <div class="progress-bar" id="myBar"></div>
      </div> 
  </header>
    <!-- HEADER AREA END tulis tahap-->

    <!-- SIDEBAR START -->
    <nav class="sidebar">
        <div class="profile_info">
            <h3><b>Menu</b></h3>
            <hr style="width: 90%; background-color: white !important; margin: 5px 0 5px 0; height:3px !important;" >
        </div>
        <ul>
            <li><a href="datasiswa.html" class="menu-btn"><i class="fa-solid fa-user"></i>&ensp;Daftar Siswa</a></li>
            <li><a href="NilaiAktifitas.html" class="menu-btn"><i class="fa-regular fa-address-book"></i>&ensp;Nilai Aktifitas</a></li>
            <li><a href="NilaiLatihan.html" class="menu-btn"><i class="fa-solid fa-clipboard-list"></i>&ensp;Nilai Latihan</a></li>
            <li id="active"><a href="#" class="menu-btn" id="hitam"><i class="fa-solid fa-square-poll-vertical"></i>&ensp;Nilai Kuis dan Evaluasi</a></li>
            <li><a href="ManajemenKelompok.html" class="menu-btn"><i class="fa-solid fa-people-group"></i>&ensp;Manajemen Kelompok</a></li>
            <li><a href="ArsipKelompok.html" class="menu-btn"><i class="fa-solid fa-users"></i>&ensp;Arsip Kelompok</a></li>
      </ul>
    </nav>
    <!-- SIDEBAR END -->

    <!-- CONTENT AREA START-->
    <div class="content">
    <!-------------------------------------------------------- Nilai Kuis dan Evaluasi ------------------------------------------------------------------>
      <div class="card-header"><center>Nilai Kuis dan Evaluasi</center></div>
        <!-----------------------------------------------Modal Tambah Data Siswa ------------------------------------------------------->
        <!-- <div class="modal fade" id="tambahModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered " >
              <div class="modal-content" style="background-color: white;">
                <div class="modal-header">
                  <h5 class="modal-title fw-bold text-dark " id="exampleModalLabel">TAMBAH DATA</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" >
                  <div class="popup add">
                    <form action="" style="background-color: white;">
                      <div class="mb-3">
                        <label>NISN :</label>
                        <input type="text" class="form-control" id="tambahNisnbox">
                      </div>
                      <div class="mb-3">
                        <label>Nama :</label>
                        <input type="text" class="form-control" id="tambahNamabox">
                      </div>
                      <div class="mb-3">
                        <label>Kelas :</label>
                        <input type="text" class="form-control" id="tambahKelasbox">
                      </div>
                      <div class="mb-3">
                        <label>Kelompok :</label>
                        <input type="text" class="form-control" id="tambahKelompokbox">
                      </div>
                      <div class="mb-3">
                        <label>Password :</label>
                        <input type="text" class="form-control" id="tambahPasswordbox">
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Kembali</button>
                        <button type="submit" class="btn btn-success" id="submit">Tambah</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div> -->
        
        <br>

        <!-------------------------------------------------------------Tabel Siswa ----------------------------------------------------------->
        <div class= "content-card" id="menu-show1">
          <div class="table-responsive-sm container mt-3">
            <table class="table text-center table-bordered" style="border-color: #555;background-color: #fff; color: #555;">
                <thead class="text-center" style="border-color: #555;background-color: #AAD8D3; color: #555;">
                    <th>No.</th>
                    <th>Nama</th>
                    <th>Kelas</th>
                    <th>Kuis 1</th>
                    <th>Kuis 2</th>
                    <th>Kuis 3</th>
                    <th>Kuis 4</th>
                    <th>Kuis 5</th>
                    <th>Kuis 6</th>
                    <th>Evaluasi</th>
                </thead>
                <tbody id="tbody1"></tbody>
            </table>
        </div>
        </div>

        <!--------------------------------------------------------------Footer -------------------------------------------------------------->
        <!-- <div class="footer-nav">
            <a href="#" class="footer-number">Sebelumnya</a>
            <a href="#" class="footer-number">1</a>
            <a href="#" class="footer-number">2</a>
            <a href="#" class="footer-number">3</a>
            <a href="#" class="footer-number">Selanjutnya</a>
        </div> -->
    </div>
    
    <!--CONTENT AREA END -->
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
    <script type="module">
      //---------project setting firebase-----------
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
      
      const firebaseConfig = {
          apiKey: "AIzaSyBAEK9blcK9ZjeIT8kPPWk8_xv7jgwjYQo",
          authDomain: "pplh-70ccb.firebaseapp.com",
          databaseURL: "https://pplh-70ccb-default-rtdb.firebaseio.com",
          projectId: "pplh-70ccb",
          storageBucket: "pplh-70ccb.appspot.com",
          messagingSenderId: "823611849079",
          appId: "1:823611849079:web:a0f8c81197a46a2e1dc972"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      import { getDatabase, ref, child, onValue, get, set, query, remove, orderByChild } 
      from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
      
      const db = getDatabase();
      //------------------------------------------------------------Tambah data------------------------------------------------------------
      // let btnTambahData = document.getElementById('submit');
      // btnTambahData.addEventListener('click', function(){
      //   console.log(btnTambahData);
      //   let tambahNisn = document.getElementById("tambahNisnbox").value;
      //   let tambahNama = document.getElementById("tambahNamabox").value;
      //   let tambahKelas = document.getElementById("tambahKelasbox").value;
      //   let tambahKelompok = document.getElementById("tambahKelompokbox").value;
      //   let tambahPassword = document.getElementById("tambahPasswordbox").value;
      //   console.log(tambahNisn);

      //   const dbRef = ref(db);


      //     get(child(dbRef, "dataSiswa/" + tambahNisn)).then((snapshot)=>{
      //       if(snapshot.exists()){
      //         alert("Akun telah ada!");
      //       }
      //       else{
      //         set(ref(db, "dataSiswa/"+ tambahNisn),
      //         {
      //           nisn: tambahNisn,
      //           nama: tambahNama,
      //           kelas: tambahKelas,
      //           kelompok: tambahKelompok,
      //           password: tambahPassword,
      //         })
      //         .then(()=>{
      //           console.log(tambahNisn);
      //           alert("Pengguna Berhasil ditambahkan")
      //         })
      //         .catch((error)=>{
      //           alert("error"+error);
      //         })
      //       }
      //     })
        
      // })

      // const dbRef = ref(db);
      // onValue(usersRef, (snapshot)=>{
      //   const users = snapshot.val();
      //   tbody1.innerHTML = "";
      // });

      //-------------------------------------------------------------Menampilkan semua data siswa--------------------------------------------
      //---------------------filling the table-------------
      var stdNo = 0;
      var tbody = document.getElementById('tbody1');

      function AddItemToTable(nisn, nama, kelas, kelompok, password){
          let trow = document.createElement("tr");
          let td1 = document.createElement('td');
          let td2 = document.createElement('td');
          let td3 = document.createElement('td');
          let td4 = document.createElement('td');
          let td5 = document.createElement('td');
          let td6 = document.createElement('td');
          let td7 = document.createElement('td');


          td1.innerHTML= ++stdNo;
          td2.innerHTML= nisn;
          td3.innerHTML= nama;
          td4.innerHTML= kelas;
          td5.innerHTML= kelompok;
          td6.innerHTML= password;
          td7.innerHTML= `<button type="button" class="delete btn btn-danger">Hapus</button> <button type="button" class="btn btn-primary">Edit</button>`;


          trow.appendChild(td1);
          trow.appendChild(td2);
          trow.appendChild(td3);
          trow.appendChild(td4);
          trow.appendChild(td5);
          trow.appendChild(td6);
          trow.appendChild(td7);

          tbody.appendChild(trow);

          //hapus data
          let deleteButtons = document.querySelectorAll(".delete");
                                deleteButtons.forEach((deleteBtn) => {
                                  deleteBtn.addEventListener("click", () => {
                                      console.log(deleteButtons);
                                      Swal.fire({
                                      title: 'Apa kamu yakin menghapus data?',
                                      text: '',
                                      icon: 'question',
                                      showCancelButton: true,
                                      confirmButtonColor: '#3085d6',
                                      cancelButtonColor: '#d33',
                                      confirmButtonText: 'Iya',
                                      cancelButtonText: 'Batal',
                                    }).then((result) => {
                                      if (result.value) {

                                        const db = getDatabase();
                                        let userId = deleteBtn.parentElement.parentElement.dataset.id;
                                        console.log(userId);
                                        remove(ref(db, "dataSiswa/" + userId));
                                        
                                        Swal.fire({
                                          title: "Selamat!",
                                          text: "Data berhasil dihapus.",
                                          icon: "success",
                                          button: "Lanjutkan",
                                        });
                                        
                                      }
                                    });
                                  
                                  
                                  });
                                });
      }

      // function AddAllItemsToTable(TheStudent){
      //     stdNo=0;
      //     tbody.innerHTML="";
      //     TheStudent.forEach(element => {
      //         AddItemToTable(element.nisn, element.nama, element.kelas, element.kelompok, element.password);
      //     });
      // }

                                


      //------------------------ambil semua data--------------
      // function GetAllDataOnce(){
      //     const dbRef = ref(db);

      //     get(child(dbRef, "dataSiswa"))
      //     .then((snapshot)=>{
      //         var students = [];

      //         snapshot.forEach(childSnapshot =>{
      //             students.push(childSnapshot.val());
      //         });

      //         AddAllItemsToTable(students);
      //     })
      // }
      // window.onload = GetAllDataOnce;

      let tmp = document.querySelector('#tbody1');
      const que = query(ref(db, "dataSiswa/"), orderByChild("nisn"));
                          onValue(que, (snapshot) => {
                                console.log(snapshot.val());
                                tmp.innerHTML = "";
                                var no = 1;
                                const users = snapshot;
                                users.forEach(user => {
                                  const userVal = user.val();
                                    let tr = `
                                        <tr data-id = ${user.key}>
                                          <td>${no}</td>
                                          <td>${userVal.nama}</td>
                                          <td>${userVal.kelas}</td>
                                          <td>${userVal.kuis1}</td>
                                          <td>${userVal.kuis2}</td>
                                          <td>${userVal.kuis3}</td>
                                          <td>${userVal.kuis4}</td>
                                          <td>${userVal.kuis5}</td>
                                          <td>${userVal.kuis6}</td>
                                          <td>${userVal.Evaluasi}</td>

                                            
                                        <tr>
                                        `;
                        
                                  tmp.innerHTML += tr;
                                  no++;
                                //////////////////////////////////////////////////////////

                                //Delete
                                let deleteButtons = document.querySelectorAll(".delete");
                                deleteButtons.forEach((deleteBtn) => {
                                  deleteBtn.addEventListener("click", () => {
                                  
                                      Swal.fire({
                                      title: 'Apa kamu yakin mengapus data?',
                                      text: '',
                                      icon: 'question',
                                      showCancelButton: true,
                                      confirmButtonColor: '#3085d6',
                                      cancelButtonColor: '#d33',
                                      confirmButtonText: 'Iya',
                                      cancelButtonText: 'Batal',
                                    }).then((result) => {
                                      if (result.value) {
                                        
                                        
                                        const db = getDatabase();
                                        let userId = deleteBtn.parentElement.parentElement.dataset.id;
                                        remove(ref(db, "dataSiswa/" + userId));
                                        
                                        Swal.fire({
                                          title: "Selamat!",
                                          text: "Data berhasil dihapus.",
                                          icon: "success",
                                          button: "Lanjutkan",
                                        });
                                        
                                      }
                                    });
                                  
                                  
                                  });
                                });
                                //////////////////////////////////////////////////////////
                                  

                                })
                                

                              });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    let nama2 = document.getElementById('nama');
    let nm = sessionStorage.getItem('nama');

    nama2.innerHTML = `<i class="fa-solid fa-user"></i> ${nm}`;

    let logout = document.getElementById("logout");
    logout.addEventListener("click", ()=>{
        // Membersihkan session storage
        sessionStorage.clear();
    });

  </script>
</body> 
</html>

    <!-- JAVASCRIPT AREA END -->